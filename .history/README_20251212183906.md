# Django

## Creating a Django Project

- When Creating a django project it is always important to create a virtual environment.

```python
python -m venv .venv
```

- After that it is important to install Django.

```python
python -m pip install Django  
```

- To create a django project we use the command.
  
```python
django-admin startproject smartnotes  
```

- To run the project you use the command.

```python
python manage.py runserver 
```

## Creating an App

- Due to the Django MVT/MVC Architecture, Django was trying to ensure that the wide projects is broken down into small apps.
- To create an app inside the Django project we use the command.

```python
django-admin startapp home
```

- home is the name of the app inside the smartnotes project
- The app is then defined in the INSTALLED_APPS array in the settings.py

```python
INSTALLED_APPS = [
    .
    .
    .
    
    # Apps
    'home',
]
```

- Now in the home app, we go to the views.py file and import HttpResponse from django.http.
- Then define the functions in the view

```python
from django.http import HttpResponse

def home(request):
    return HttpResponse("Hello World")
```

- Now in the project under urls.py we need to define a path to that view.

```python
from django.contrib import admin
from django.urls import path
from home import views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('home', views.home)
]
```

![alt text](image.png)

## The MVT framework

- Django uses Model View Template framework.

![alt text](image-1.png)

- Model - Handles Data.
- View - Responsible for handling request and responses.
- Template - Allow us to render data into html pages.

## Template pages

- To use the .html page files one creates a template folder inside the app and inside the template folder you create another folder with the name of the app.
- Now of the views.py, you can render the pages correctly.

```python
def welcome(request):
    return render(request, "home/welcome.html", {'today': datetime.today()}) 
```

- urls.py

```python
from django.contrib import admin
from django.urls import path
from home import views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('home', views.home),
    path('', views.welcome)
]

```

![alt text](image-3.png)

## Cleaning the Project Structure

- In order to ensure that if the home app is not interdependent with the project, we will create urls.py file in the home app.
- Then we will include the path only in the project urls.py
- home/urls.py

```python
from django.urls import path
from . import views

urlpatterns = [
    path('home', views.home),
    path('', views.welcome)
]
```

- urls.py

```python
from django.contrib import admin
from django.urls import path, include


urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include("home.urls"))
]

```

- That ensures that the project is well Organized.

## Migrations

- Whenever there are changes in the database Django always say that there are migrations that need to be done. This is important since it fully updates the database.
- We do this by using the command

```python
python manage.py migrate
```

![alt text](image-4.png)

## Creating Django Admin SuperUser

- In order to be able to login to the admin Dashboard that comes by default in Django, we need to create a Super User

```python
python manage.py createsuperuser  
```

- Output

```python                                                        smartnotes 04:33:16
Username (leave blank to use 'josephmbote'): mbote
Email address: mbotejoseph001@gmail.com
Password: 
Password (again): 
Superuser created successfully.
```

## Adding Authorization to a view

- If we want to restrict specific pages to only the logged in users, Django has a way that it have implemented it in a simple way.
- In views.py in the app where the page is being rendered. we import the login_required decorator and then add the decorator on top of the view functions

```python
from django.shortcuts import render
from django.contrib.auth.decorators import login_required

book = {
        "name": "Think Big",
        "Author": "Ben Carson",
        "year": 2020,
        "Genre": "Motivation"
    }
# Create your views here.
@login_required(login_url='/admin')
def books(request):
    return render(request, "books/index.html", {'books' : book})
```

## Django ORM

- In Django we create our own models.
- Django uses Object Relation Mapping which allow us to create our models which we can migrate to databases to allow communication.

![alt text](image-5.png)

- The way we transform a Model into a Database table is by the creation of the migrations. We can also use makemigrations the way we use migrate.

![alt text](image-7.png)

## Creating models

- We start by creating the app where we want to create the models
- Then on the apps, models.py we create a model

```python
from django.db import models

# Create your models here.
class Notes(models.Model):
    title = models.CharField(max_length=200)
    text = models.TextField()
    created = models.DateTimeField(auto_now_add=True)
```

- From there we need to makemigrations

```python
python manage.py makemigrations
```

- From there we need now to migrate

```python
python manage.py migrate
```

![alt text](image-8.png)

- In order to make it possible to display the Tables from the models that were created, we need to go to the admin.py in the app and import that model